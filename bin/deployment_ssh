#!/usr/bin/env python
# -*- coding: utf-8 -*-
import os
import sys


abspath = os.path.abspath
pjoin = os.path.join
dirname = os.path.dirname
isdir = os.path.isdir
exists = os.path.exists


def calculatepath(place, *path):
    absolute_here = abspath(place)  # always in the place where it was called
    return abspath(pjoin(absolute_here, *path))


def get_root(root=None):
    return root or os.environ.get('VENV_ROOT_PARENT') or calculatepath(".")


def get_deployment_settings(root=None):
    sys.path.insert(0, get_root(root))
    from deployment import settings
    return settings


def bash_ssh_command(name, root=None):
    deployment = get_deployment_settings(root)
    settings = deployment[name]
    user = settings['user']
    host = settings['hosts'][0]  # take first
    return "ssh %s@%s" % (user, host)


def print_bash_command(ssh_command):
    print >> sys.stderr, ssh_command
    print ssh_command


def main():
    print_bash_command(
        bash_ssh_command(sys.argv[1])
    )


if __name__ == '__main__':
    main()
